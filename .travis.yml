language: python
os:
- linux
python:
- 2.7
- 3.6
env:
  matrix:
  - AWKWARD="awkward>=0.8.4"
  - AWKWARD="awkward-numba==0.8.15 uproot-methods==0.4.7 uproot==3.4.19"
matrix: 
addons:
  apt:
    packages:
    - python-setuptools
script:
- python setup.py flake8
- coverage run --source=coffea/ setup.py pytest
install:
- pip install --upgrade setuptools_scm
- pip install codecov
- PY_MAJ=`python -c 'import sys; print(sys.version_info[0])'`
- PY_MIN=`python -c 'import sys; print(sys.version_info[1])'`
- if [ $PY_MAJ -eq 3 ]; then pip install pandas pyarrow cloudpickle lz4 jinja2 parsl;
  fi
- if [ $PY_MAJ -eq 3 ] && [ $PY_MIN -eq 6 ]; then  pip install pyspark; fi
- pip install ${AWKWARD}
- pip install scipy
- pip install numpy --upgrade
- python -c 'import numpy; print(numpy.__version__)'
- pip install pytest pytest-runner flake8
branches:
  only:
  - master
  - /v(\d+)?\.(\d+)\.(\d+)/
after_success:
  - if [ $TRAVIS_PYTHON_VERSION = "3.6" ] && [ $AWKWARD = "awkward>=0.8.4" ]; then codecov; fi
deploy:
  - provider: releases
    user: lgray
    api_key: $GITHUB_OAUTH_TOKEN
    on:
      tags: true
      branch: master
      condition: $TRAVIS_PYTHON_VERSION = "3.6" && $AWKWARD = "awkward>=0.8.4"
  - provider: pypi
    user: lgray
    password:
      secure: "S68BJTWOexkTUM5CrxWbg2VH99k52hUJJscqw3zxdkarg7pbv3MeAJtRUlvPnkFITspVrpbz1+KQsu4Lq+A8UPWiM/zdgLQ8J0sxQ2B8CFlptnnFLxUAOcJEB4dwAdpWD4RmP9Yf9+BXVkbzuNxbKMtaAx3aOGCEy98+VYDS64t5F2z4xUbpOh3ih1jer9FKOjx4uro4utuPnEF6xd2NuSQHHro72SeH4W/ek3PljI1B2AFeUg7mjJnydQ4gKA1VVtMt3OD07SwEdIBdpPaeLaa2chsA5FUMG2El312vKw/IwgrthQ2O/98tgIVSgiqJpzo1cBfDLMrgl6HUSjdjgmqqJ4ggks6HBv2/GQ8rr9LdWDN9JwcF2FGQsi6YRGXkdMxDtvPm7O1iMDIDP4I00F9RPax5W/XhCIk1ZH4k8Aeve0rRSkAjigJjEuCnyIOAh2EEW8vH/qQjK4AnBWOG0Hoz4VHCJyyC9cvuBZGHz/lGrwPrX7/8ZkzQbVHIJjPG5FSF3r4A1m/V6LYm1VYk45WOGlgCqwD9SK/6DS+4UbRnN8lqjsZHD7VdVg6/kRKWMakeZ62pha4CsR8XWCeN/J0yMf90CwkF/KRpWy9TjBpoRsuCQcEX0bX9TK1gTw4TlZlRgzzq4gICIXudzqaYV71bP3dqgWkwCJArt0x+j1M="
    distributions: sdist bdist_wheel --universal
    on:
      tags: true
      branch: master
      condition: $TRAVIS_PYTHON_VERSION = "3.6" && $AWKWARD = "awkward>=0.8.4"
